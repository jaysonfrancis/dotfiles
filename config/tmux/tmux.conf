#### General Settings ####
set -g default-command /bin/zsh
set -g default-terminal "screen-256color"
set-option -g focus-events on  # Required for auto-reload in editors

#### Detect if inside SSH (remote) ####
if-shell '[ -n "$SSH_CONNECTION" ]' \
  'set -g @host_type remote' \
  'set -g @host_type local'

# allow title change
# set-option -g allow-rename off
set -g allow-rename off
set -g automatic-rename on
set -g automatic-rename-format '#{b:pane_current_path}'

# type ":sync" to toggle synchronize panes
set -as command-alias "sync=set -w synchronize-panes\; display 'synchronize-panes: #{?pane_synchronized,on,off}'"

#### Terminal & Colors ####
set-option -sa terminal-overrides ",xterm*:Tc"  # TrueColor Support
set-option -a terminal-features 'xterm-256color:RGB'
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # Undercurl support
set -as terminal-overrides ',*:Setulc=\E[58::2::::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # Undercurl colors

# reorder tabs
bind-key -n S-Left swap-window -t -1\; select-window -t -1
bind-key -n S-Right swap-window -t +1\; select-window -t +1

#### Status Bar ####
set-option -g status on
set-option -g status-interval 5  # Refresh rate (lower for better performance)
set-option -g status-justify left
set-option -g status-left "[#S] "  # Show only session name
set-option -g status-right "#(whoami)@#H | %Y-%m-%d %H:%M"  # Show username, hostname, and time

#### Window & Pane Indexing ####
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on  # Auto-renumber windows when closing one

#### Window & Pane Behavior ####
set-window-option -g monitor-activity off  # Enable activity alerts
set-option -g visual-activity off

#### Scrolling & History ####
set -g history-limit 50000  # Increase scrollback buffer
set -s escape-time 0  # Improve Vim mode switching delay
set -g mouse on  # Enable mouse support
set -g terminal-overrides ',*:smcup@:rmcup@'  # Fix mouse scroll issues in some terminals

#### Theme and window formats ####
if-shell '[ "#{@host_type}" = "local" ]' \
  'set -g status-style "bg=black,fg=white"; \
   set -g @win_fmt_hidden_local        "#[fg=white,bg=black] #I "; \
   set -g @win_fmt_current_hidden_local "#[fg=black,bg=colour34,bold] #I "; \
   set -g @win_fmt_shown_local         "#[fg=white,bg=black] #I #[fg=white,bg=black]#W "; \
   set -g @win_fmt_current_shown_local  "#[fg=black,bg=colour34,bold] #I #[fg=black,bg=colour34]#W "; \
   set-window-option -g window-status-format "#[fg=white,bg=black] #I #[fg=white,bg=black]#W "; \
   set-window-option -g window-status-current-format "#[fg=black,bg=colour34,bold] #I #[fg=black,bg=colour34]#W "' \
  'set -g status-style "bg=white,fg=black"; \
   set -g @win_fmt_hidden_remote        "#[fg=black,bg=white] #I "; \
   set -g @win_fmt_current_hidden_remote "#[fg=white,bg=colour205,bold] #I "; \
   set -g @win_fmt_shown_remote         "#[fg=black,bg=white] #I #[fg=black,bg=white]#W "; \
   set -g @win_fmt_current_shown_remote  "#[fg=white,bg=colour205,bold] #I #[fg=white,bg=colour205]#W "; \
   set-window-option -g window-status-format "#[fg=black,bg=white] #I #[fg=black,bg=white]#W "; \
   set-window-option -g window-status-current-format "#[fg=white,bg=colour205,bold] #I #[fg=white,bg=colour205]#W "'

#### Toggle Window Name Visibility ####
bind-key n if-shell '[ "$(tmux show -gv @win_names)" = "1" ]' \
  "set -g @win_names 0; \
   if-shell '[ \"#{@host_type}\" = \"local\" ]' \
      'set-window-option -g window-status-format \"#[fg=white,bg=black] #I \"; \
       set-window-option -g window-status-current-format \"#[fg=black,bg=colour34,bold] #I \"' \
      'set-window-option -g window-status-format \"#[fg=black,bg=white] #I \"; \
       set-window-option -g window-status-current-format \"#[fg=white,bg=colour205,bold] #I \"'" \
  "set -g @win_names 1; \
   if-shell '[ \"#{@host_type}\" = \"local\" ]' \
      'set-window-option -g window-status-format \"#[fg=white,bg=black] #I #[fg=white,bg=black]#W \"; \
       set-window-option -g window-status-current-format \"#[fg=black,bg=colour34,bold] #I #[fg=black,bg=colour34]#W \"' \
      'set-window-option -g window-status-format \"#[fg=black,bg=white] #I #[fg=black,bg=white]#W \"; \
       set-window-option -g window-status-current-format \"#[fg=white,bg=colour205,bold] #I #[fg=white,bg=colour205]#W \"'"

#### Rename Window Quickly ####
bind-key r command-prompt -I "#W" "rename-window '%%'"

#### Key Bindings ####
unbind C-b  # Unbind default prefix
set -g prefix `  # Change prefix to backtick (`) for easier access
bind ` send-prefix # Press twice for remote prefix

#### Pane Border Colors ####
set -g pane-border-style "fg=#073642"
set -g pane-active-border-style "fg=#eee8d5"

# Window list formatting
# set -g window-status-format "#[fg=white,bg=black] #I #[fg=white,bg=black]#W "
# set -g window-status-current-format "#[fg=black,bg=colour34,bold] #I #[fg=black,bg=colour34]#W "
#### Status-right (local + remote themed) ####
if-shell '[ "#{@host_type}" = "local" ]' \
  'set -g status-right "#{?window_zoomed_flag,#[fg=green][Z]#[default],} \
#[fg=white,bg=black]\
#[fg=black,bg=white]\
#[fg=black,bg=colour34,bold] #h "' \
  'set -g status-right "#{?window_zoomed_flag,#[fg=green][Z]#[default],} \
#[fg=black,bg=white]\
#[fg=white,bg=colour205]\
#[fg=white,bg=colour205,bold] #h "'

# set -g status-right "#{?window_zoomed_flag,#[fg=green][Z]#[default],} \
# #[fg=white,bg=black]\
# #[fg=black,bg=white]\
# #[fg=black,bg=colour34,bold] #h "

# setw -g window-status-activity-style "underscore,fg=#839496,bg=#002b36"
# setw -g window-status-separator ""
# setw -g window-status-style "NONE,fg=#839496,bg=#002b36"
# setw -g window-status-format '#[fg=#002b36,bg=#002b36]#[default] #I  #{b:pane_current_path} #[fg=#002b36,bg=#002b36,nobold,nounderscore,noitalics]'
# setw -g window-status-current-format '#[fg=#002b36,bg=#eee8d5]#[fg=#b58900,bg=#eee8d5] #I #[fg=#eee8d5,bg=#b58900] #{b:pane_current_path} #[fg=#b58900,bg=#002b36,nobold]'

# Local Machine Window Highlight
# set-window-option -g window-status-current-style fg=colour63  # Purple

#### Plugins ####
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect' #

#### Initialize TMUX Plugin Manager (Keep at the Bottom) ####
run '~/.tmux/plugins/tpm/tpm'
